"use strict";(self.webpackChunkblogs_express=self.webpackChunkblogs_express||[]).push([[7971],{4055:(n,s,a)=>{a.r(s),a.d(s,{default:()=>e});const p=(0,a(273).uE)('<h1>为老 vueCli 项目添加 vite 支持</h1><h2 id="_1、前言" tabindex="-1"><a class="header-anchor" href="#_1、前言" aria-hidden="true">#</a> 1、前言</h2><p>接手公司的某个项目已经两年了，现在每次启动项目都接近 1 分钟，hmr 也要好几秒的时间，but vite2 发布之后就看到了曙光，但是一直没有动手进行升级，昨天终于忍不住了，升级之后几秒钟就完成了。</p><h2 id="_2、开始升级" tabindex="-1"><a class="header-anchor" href="#_2、开始升级" aria-hidden="true">#</a> 2、开始升级</h2><blockquote><p>注：只是升级了开发环境，打包依旧是 webpack（也试过打包也用 vite，但是打包后发现 iview 的字体图标出现问题了，初步验证是静态资源的问题，vite 打包后的静态资源默认放到 assets 下，如果有解决的同学麻烦告知下解决方案）</p></blockquote><h3 id="v2-1-安装-vuecli-插件-vite" tabindex="-1"><a class="header-anchor" href="#v2-1-安装-vuecli-插件-vite" aria-hidden="true">#</a> v2.1 安装 vuecli 插件 vite</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>vue <span class="token function">add</span> vit <span class="token comment"># 添加vite插件</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>插件安装完成后会在 package.json 中的 script 添加：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;vite&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./bin/vite&quot;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>使用 <code>pnpm</code> 的同学，如果项目根目录下没有 <code>.npmrc</code> 文件请自行添加并在文件内加上 <code>shamefully-hoist=true</code>；否则安装 vite 插件可能会失败。</p></blockquote><h3 id="_2-2、运行项目并排查错误" tabindex="-1"><a class="header-anchor" href="#_2-2、运行项目并排查错误" aria-hidden="true">#</a> 2.2、运行项目并排查错误</h3><h4>2.2.1、TypeError: Cannot read property &#39;alias&#39; of undefined</h4><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/798a149c30c84310a383938c7d78f0f8~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>这个错误是因为在<code>vue.config.js</code>中的<code>configureWebpack</code>只能使用对象的配置方法(vue cli 支持对象和函数两种方式)</p><h4>2.2.2 Unrestricted file system access to &quot;/src/components/editPwd</h4><p>出现这个问题的原因是：vite 默认配置中的<code>extensions</code>不包含<code>.vue</code>;解决方法：</p><ul><li>1、在 vue.config 中加上 extensions</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>\n    resolve<span class="token operator">:</span> <span class="token punctuation">{</span>\n      extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.mjs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.vue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>2、所有 vue 组件在导入时加上<code>.vue</code>的后缀名。</li></ul><h4>2.2.3、启动端口不是 8080</h4><blockquote><p>vite 默认的启动端口是<code>3000</code>，所以需要在<code>vue.config.js</code>中的<code>devServer</code>中加上<code>port:8080</code></p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>\n    port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4>2.2.4、开发时的代理失效</h4><p>代理失效的原因：在 <code>vueCli</code> 中的重写配置是 <code>pathRewrite</code>，而在 <code>vite</code> 中是 <code>rewrite</code>.</p><p>解决方法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>\n    port<span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>\n    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token string">&quot;/api/cost/&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:9331&quot;</span><span class="token punctuation">,</span>\n        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token string">&quot;^/api/cost/&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token function-variable function">rewrite</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\/api\\/cost\\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 适配vite</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;/api/import/&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:9332&quot;</span><span class="token punctuation">,</span>\n        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token string">&quot;^/api/import/&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token function-variable function">rewrite</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\/api\\/import\\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 适配vite</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;/api/&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:9333&quot;</span><span class="token punctuation">,</span>\n        ws<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>\n          <span class="token string">&quot;^/api/&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token function-variable function">rewrite</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\/api\\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 适配vite</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="_3、升级完成" tabindex="-1"><a class="header-anchor" href="#_3、升级完成" aria-hidden="true">#</a> 3、升级完成</h2><p>至此整个升级过程就结束了，总的来说还是比较顺利的没有太多坑，都是一些比较好解决的问题。最后感谢各位观众老爷的能看到最后 O(∩_∩)O 希望你能有所收获 😁</p>',28),e={render:function(n,s){return p}}},2045:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-169dfa3b",path:"/vue/p202109101.html",title:"为老 vueCli 项目添加 vite 支持",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"1、前言",slug:"_1、前言",children:[]},{level:2,title:"2、开始升级",slug:"_2、开始升级",children:[{level:3,title:"v2.1 安装 vuecli 插件 vite",slug:"v2-1-安装-vuecli-插件-vite",children:[]},{level:3,title:"2.2、运行项目并排查错误",slug:"_2-2、运行项目并排查错误",children:[]}]},{level:2,title:"3、升级完成",slug:"_3、升级完成",children:[]}],filePathRelative:"vue/p202109101.md",git:{updatedTime:1634016875e3}}}}]);